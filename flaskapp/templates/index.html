<!DOCTYPE html>
<html lang="en">

<!-- Head, includes imports --!>
<head>
    <title> Network Music Generator </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    
    <script src="http://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
	<script src="/static/interaction.js"></script>
    <script src="/static/observable.js" type="module"></script>
</head>

<!--CSS Style descriptors --!>
<style>
    div.scroll_div {
      background-color: lightblue;
      width: 600px;
      height: 110px;
      overflow: scroll;


    }

    div.gen_info {
    background-color: #78b3e0;

    }

    p.setting {
       background-color: lightgreen;
    }
</style>

<!-- Body --!>
<body>


    <!-- Title and tagline --!>
    <div class="jumbotron text-center">
      <h1>Network Music Generator</h1>
    <!--  <p>Resize this responsive page to see the effect!</p> --!> 
    </div>
 
 <!-- Main app  --!> 

 <!-- Embedded Observable --!>


  <div class="container">
   <div class="row">
    <h3> 
        This Graph is build from a score 
        where pitches and/or harmonies are 
        mapped to nodes and pitch/harmony 
        transitions are mapped to links.
        Click "Start Walk" below to hear how 
        the score's original melody moves through 
        the graph. Change how notes map to nodes 
        by changing graph encoding below, or show 
        different community partitions by
        changing community algorithmn below. You can 
        also generate different "random walks" on 
        this graph as a form of algorithmic composition. 
    </h3>
    
   </div>
   <div class="row">
    <div class="col-sm-1">
       <div class="row">
            <h4> Press to Start Walk </h4>
            Setting: <p class="setting"> {{setting}}</p>
            <div>
                <span id="start_walk"></span>
            </div>
                     
       </div>
       <div class="row">

            <h4> Visualization Parameters </h4>
            <br>
            <div id="radius"></div>
            <br>
            <div id="attraction"></div>
            <br>
            <div id="distance"></div>
            <br>
            <h4> Audio Parameters </h4>
            <br>
            <div id="speed"></div>
            <br>
            <div id="wavetype"></div>
                  
       </div>
    </div>
    <div class="col-sm-11">

       <div id="chart"></div>

    </div>

   </div>

 </div>
<!-- menu test --!>

    <div class="container">

      <ul class="nav nav-tabs">
        <li class="active"><a data-toggle="tab" href="#menu0">
                Upload New Piece</a></li>
        <li><a data-toggle="tab" href="#menu1">Change Graph Structure</a></li>
        <li><a data-toggle="tab" href="#menu2">Change Community Assignment</a></li>
        <li><a data-toggle="tab" href="#menu3">Change Edge Weights</a></li>
      </ul>

      <div class="tab-content">
      
        <!-- Upload New File--!>

        <div id="menu0" class="tab-pane fade in active">
                <h2> Upload New Piece        </h2>
              <div class="row">
                <div class="col-sm-8">

                  <h3> Note: Only the top system of the piece will be 
                    considered for the Basic and Grouped graphs. 
                    In the Roman Numeral and 
                    Grouped Roman Numeral Graphs, the highest note 
                    is considered the melody.
                    <i>If your file is not being processed, please email 
                    kpet@iu.edu for 
                    troubleshooting help </i> 
                   </h3>
               
                </div>
                <div class="col-sm-4">
                    Code adapted from https://stackoverflow.com/questions/18334717/how-to-upload-a-file-using-an-ajax-call-in-flask  

             

                <form id="upload-file" method="post" enctype="multipart/form-data">
                 
                        <label for="file">Select a file.
                        Accepts files with the extension
                        <i>.xml</i>, <i>.mxl</i>, <i>.mid</i> 
                        and <i>.musicxml</i>
                        </label>
                        <input name="file" type="file">
                 
                        <button id="upload-file-btn" type="button">Upload</button>
               
                </form>
         

              </div>
            </div>
            <div class="row">
              <div class="col-sm-6">
                 <h2> 
                 Step 2: Enter Information about 
                 the piece you uploaded (you can ignore
                 this if using the default data.) 
                 The key of the piece is used for 
                 Roman Numeral Harmonic Analysis - 
                 right now we don't support key 
                 changes so just pick one :). 
                 To create separate subgraphs for different
                 sections of the piece, end the measure 
                 and note offset of the position 
                 you want that break to be.   
                 </h2>
               </div>
               <div class="col-sm-6">

         
                 <form id="changeparams"  method = "post" 
                        enctype="multipart/form-data">
               
                    <label for="key">
                    Enter Key of piece being processed. 
                    (for pieces in a minor 
                    key, enter the relative major):
                    </label>
                    <input type="text" id="key" name="key">
                    (e.g. <i>A</i>  )          
                    <br>
                    <br>
                    <label for="grouping">
                    Enter New Measure Offsets for Forced Grouping graph 
                    as measure numbers separated by spaces:
                    </label>
                    <input type="text" id="grouping" name="grouping" >
                    ( e.g. <i>1 10 20 </i>) 
                    <br>
                    <br>
                    <label for="offsets">
                        Enter New New Note Offsets for Roman Numeral Forced 
                        Grouping Graph as note offsets separated by spaced:
                    </label>
                    <input type="text" id="offsets" name="offsets" >
                    (e.g. <i>1  35 50 90</i>)
                   <br>
                  
                    <button id = "update-params-btn" type="button">
                    Submit
                    </button>
            
              </form>

           </div> 
          </div>  

        </div>    <!--close menu--!>
       
        <!-- Change Graph Structure --!>
        <div id="menu1" class="tab-pane fade">

            <h2>
            Click the below button to change to a different encoding scheme
            </h2>
            <div class="row">  

              <div class="col-sm-3">
                <button id="basic">
                    Display Basic Graph Encoding
                </button>
              </div>

              <div class="col-sm-3">        
                <button id="grouped">
                    Display Forced Grouping Graph Encoding
                </button>		
              </div>

              <div class="col-sm-3">
                <button id="RN">
                    Diplay Roman Numeral Graph Encoding 
                </button>
              </div>

              <div class="col-sm-3">
                <button id="grouped_RN">
                    Display Grouped Roman Numeral Graph Encoding
                </button>
              </div>          

            </div>
        </div>
        
        <!-- Change Community Assignment --!>

        <div id="menu2" class="tab-pane fade">

            <h2>
            Click the below button to change visualized communities
            </h2>
            <div class="row">
              <div class="col-sm-3">
                    <button id="infomap_vis">Change to Infomap</button>		
              </div>

              <div class="col-sm-3">
                    <button id="lpm_vis">Change to Label Propagation</button>
              </div>

              <div class="col-sm-3">
                    <button id="louvain_vis">Change to Louvain</button>
              </div>

              <div class="col-sm-3">
                    <button id="hlc_vis">Change to Hierarchical Links</button>
              </div>  
            </div>

        </div>

        <!-- Change Edge Weights --!>
        <div id="menu3" class="tab-pane fade">
            <h2> Change Edge Weight</h2>
            <p>
                You can change the weight (thickness) of edges 
                by clicking on a link to select it (the selected 
                link will turn red), typing in a new weight, then 
                clicking "submit". The altered link will turn magenta.
            </p>
            
            <p>
                Changing the weight of a node's outgoing edge alters
                the probability the next note of a generated composition
                will be the node on the other side of that link. 
                A thinker link means higher chance of transitioning,
                a thinner link means lower chance of transitioning. 
            </p>

            <div class="row">
              <div class="col-sm-2">
                Chosen Edge : 
              </div>
              <div class="col-sm-1">     
                <p id="chosen_source"></p> 
              </div>
              <div class="col-sm-1">
                TO  
              </div>
              <div class="col-sm-1">
                <p id="chosen_target"></p>
              </div>
              <div class="col-sm-2">       
                with weight 
              </div>
              <div class="col-sm-1">
                <p id="cur_weight"></p>
              </div>
            </div>
            <div class="row">  
                
                <form>
                    <label for="new_weight">
                       New Weight for Selected Edge    
                    </label>    
                    <input type="text"  id="new_weight" name="new_weight" >
                    ( e.g. <i>6</i>)
                    <button id = "change-weight-btn" type="button">Submit</button>
                </form>
            

            </div>

        </div> <!-- close menu --!>
     </div>     <!-- close tab content --!>
 </div> <!-- close container --!>

<br>
<br>


<h2>
Generate Composition from a random walk of this graph. To create the random walk, choose an option below and click "Submit"
</h2>
<div class = "gen_info">
    <form >
      <fieldset>
      <label for="walk-encoding-options">
            Choose Rhythm of Generated Composition:
      </label>
      <select id="walk-encoding-options" name="walk-encoding-options">
        <option value="ignore-comm">Ignore Communities</option>
        <option value="consider-comm">Consider Communities</option>

      </select>
      <button id = "change-walk-btn" type="button">Submit</button>
      </fieldset>
    </form>
</div>

<div>

<h2> Data and Random Walk Explorer </h2>
<div id="data"></div>
<div id="random_walk"></div>


<script>
	//These variables are instantiated in Flask and can be 
	//changed through Observable or directly through html

	
	var data = {{data|tojson}}//corresponds Observable cell
	var walk = {{walk|tojson}}//corresponds to Observable
	var key = {{key|tojson}}
	var grouping = {{grouping|tojson}}
	var offsets = {{offsets|tojson}}
    var setting = {{setting|tojson}}
	//any information coming in needs to be converted to json 
	//(to my knowlege) 
    console.log("In definiing area")
    console.log(walk)
</script>




</body>

</html>
